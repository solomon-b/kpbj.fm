# Base configuration for KPBJ streaming services
# Use with environment-specific overrides:
#   Local dev: docker compose -f docker-compose.yml -f docker-compose.dev.yml up -d
#   Staging:   docker compose -f docker-compose.yml -f docker-compose.staging.yml up -d
#   Production: docker compose -f docker-compose.yml -f docker-compose.prod.yml up -d

services:
  icecast:
    image: ghcr.io/solomon-b/kpbj-icecast:${IMAGE_TAG:-latest}
    container_name: kpbj-icecast
    ports:
      - "8000:8000"
    # Config is bundled in image; env vars applied at startup by entrypoint
    environment:
      - ICECAST_SOURCE_PASSWORD=${ICECAST_SOURCE_PASSWORD:-hackme}
      - ICECAST_ADMIN_PASSWORD=${ICECAST_ADMIN_PASSWORD:-hackme}
      - ICECAST_RELAY_PASSWORD=${ICECAST_RELAY_PASSWORD:-hackme}
    restart: unless-stopped

  liquidsoap:
    image: ghcr.io/solomon-b/kpbj-liquidsoap:${IMAGE_TAG:-latest}
    container_name: kpbj-liquidsoap
    depends_on:
      - icecast
    # Config (radio.liq) is bundled in image
    environment:
      - ICECAST_HOST=icecast
      - ICECAST_PORT=8000
      - ICECAST_PASSWORD=${ICECAST_SOURCE_PASSWORD:-hackme}
      - ICECAST_MOUNT=/stream
    restart: unless-stopped
