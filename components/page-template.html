<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>kpbj.fm</title>
    <link rel="stylesheet" href="/assets/css/output.css">
    <script src="//unpkg.com/alpinejs" defer></script>
    <script
      src="https://www.paypal.com/sdk/js?client-id=BAA56A9gcLxsoKcdDF1ipwRFhXfp8nondkp4mIJClY5tiW5pFR9C1kMlHNKYFrRYTeecQ-MzTmxkjAkFFQ&components=hosted-buttons&enable-funding=venmo&currency=USD">
    </script>
  </head>
  <body class="relative font-body flex flex-col min-h-screen" x-data="spaApp()">
    <header class="relative z-50">
      <div class="relative flex flex-col justify-center items-center p-3">
        <nav class="text-center">
            <a href="/" @click.prevent="navigateTo('home')">
              <pre class="font-mono text-sm leading-tight text-gray-800">
▄ •▄  ▄▄▄·▄▄▄▄·  ▐▄▄▄    ·▄▄▄• ▌ ▄ ·.
█▌▄▌▪▐█ ▄█▐█ ▀█▪  ·██    ▐▄▄··██ ▐███▪
▐▀▀▄· ██▀·▐█▀▀█▄▪▄ ██    ██▪ ▐█ ▌▐▌▐█·
▐█.█▌▐█▪·•██▄▪▐█▐▌▐█▌    ██▌.██ ██▌▐█▌
·▀  ▀.▀   ·▀▀▀▀  ▀▀▀•    ▀▀▀ ▀▀  █▪▀▀▀
              </pre>
            </a>
            <div class="text-sm space-x-4">
                <a href="/donate" @click.prevent="navigateTo('donate')">DONATE</a>
                <span class="text-gray-500">|</span>
                <a href="/about-us" @click.prevent="navigateTo('about-us')">ABOUT US</a>
                <span class="text-gray-500">|</span>
                <a href="mailto:contact@kpbj.fm">CONTACT</a>
            </div>
        </nav>
      </div>
    </header>

    <!-- Minimal Player Bar -->
    <div class="px-6 text-center">
      <div class="inline-flex items-center gap-4 text-sm font-mono">
        <a href="#" id="playPauseBtn" class="hover:text-gray-600 cursor-pointer">[ PLAY ]</a>
        <span class="text-gray-500">|</span>
        <div id="nowPlaying">
          NOW PLAYING: KPBJ 95.9 FM
        </div>
        <span class="text-gray-500">|</span>
        <div class="flex items-center gap-2">
          <span>VOL:</span>
          <input type="range" min="0" max="100" value="80" id="volumeSlider" class="w-20 h-1">
        </div>
      </div>
    </div>

    <div x-html="currentPageContent"></div>

    <footer class="relative z-10 bg-transparent p-6 text-center mt-auto text-sm">
      <p>&copy; 2025 Sun Valley Arts and Culture, a 501(c)(3) non-profit organization</p>
    </footer>

    <script>
      // Audio player functionality
      let audioPlayer = null;
      let isPlaying = false;

      function initAudioPlayer() {
        const playPauseBtn = document.getElementById('playPauseBtn');
        const volumeSlider = document.getElementById('volumeSlider');

        // Initialize audio element
        audioPlayer = new Audio();
        audioPlayer.src = 'https://kpbj.hasnoskills.com/listen/kpbj_test_station/radio.mp3';
        audioPlayer.volume = 0.8;

        playPauseBtn.addEventListener('click', (e) => {
          e.preventDefault();
          if (!isPlaying) {
            audioPlayer.play().then(() => {
              isPlaying = true;
              playPauseBtn.textContent = '[ PAUSE ]';
            }).catch(err => {
              console.error('Error playing audio:', err);
            });
          } else {
            audioPlayer.pause();
            isPlaying = false;
            playPauseBtn.textContent = '[ PLAY ]';
          }
        });

        volumeSlider.addEventListener('input', (e) => {
          audioPlayer.volume = e.target.value / 100;
        });
      }

      // Initialize audio player when DOM is ready
      document.addEventListener('DOMContentLoaded', initAudioPlayer);

      function handleSubmit(event) {
        const form = event.target;
        const confirmation = form.querySelector('#form-confirmation');
        const button = form.querySelector('#subscribe-button');

        // Prevent multiple submissions
        button.disabled = true;
        button.innerText = 'Submitting...';

        setTimeout(() => {
          confirmation.style.display = 'block';
          form.reset();
          button.disabled = false;
          button.innerText = 'Subscribe';
        }, 500);
      }

      function spaApp() {
        return {
          currentPage: 'home',
          currentPageContent: '<main class="text-center py-12"><p>Loading...</p></main>',
          loading: false,

          pageUrls: {
            'home': '/pages/home',
            'about-us': '/pages/about-us',
            'donate': '/pages/donate'
          },

          init() {
            // Get initial page from URL
            const path = window.location.pathname;
            if (path === '/' || path === '/index.html') {
              this.currentPage = 'home';
            } else if (path.includes('/about-us')) {
              this.currentPage = 'about-us';
            } else if (path.includes('/donate')) {
              this.currentPage = 'donate';
            }

            this.loadPage(this.currentPage);

            // Handle browser back/forward buttons
            window.addEventListener('popstate', (event) => {
              if (event.state && event.state.page) {
                this.loadPage(event.state.page, false);
              }
            });

            // Set initial history state
            history.replaceState({ page: this.currentPage }, '', this.getUrlForPage(this.currentPage));
          },

          navigateTo(page) {
            this.loadPage(page, true);
          },

          async loadPage(page, pushState = true) {
            this.loading = true;
            this.currentPage = page;

            try {
              // Fetch the HTML content for the page
              const response = await fetch(this.pageUrls[page]);
              if (!response.ok) throw new Error('Page not found');

              this.currentPageContent = await response.text();

              // Update browser history
              if (pushState) {
                const url = this.getUrlForPage(page);
                history.pushState({ page: page }, '', url);
              }

              // Load PayPal script if on donate page
              if (page === 'donate') {
                this.$$nextTick(() => {
                  if (window.paypal) {
                    paypal.HostedButtons({
                      hostedButtonId: "YBRDJJA6AGBL6",
                    }).render("#paypal-container-YBRDJJA6AGBL6");
                  }
                });
              }
            } catch (error) {
              console.error('Error loading page:', error);
              this.currentPageContent = '<main class="text-center py-12"><p>Error loading page content.</p></main>';
            } finally {
              this.loading = false;
            }
          },

          getUrlForPage(page) {
            if (page === 'home') return '/';
            return '/' + page + '/';
          }
        };
      }
    </script>
  </body>
</html>
